<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚¯ã‚¨ã‚¹ãƒˆãƒœãƒ¼ãƒ‰</title>
  <style>
    body {
      font-family: 'Cinzel', serif;
      margin: 0;
      padding: 0;
      background-color: #121212;
      color: #f1e4d3;
    }
    .board {
      display: flex;
      justify-content: space-around;
      margin: 10px;
    }
    .main {
      width: 95%;
      padding: 10px;
      border: 2px solid #6d4c41;
      background-color: black;
      min-height: 120px;
      justify-content: space-around;
      border-radius: 10px;
      box-shadow: 0 0 10px #b5a7bc;
    }
    #new-task {
      width: 30%;
    }
    .column {
      width: 30%;
      padding: 10px;
      border: 2px solid #6d4c41;
      background-color: black;
      min-height: 150px;
      border-radius: 10px;
      box-shadow: 0 0 10px #b5a7bc;
    }
    .task {
      margin: 10px;
      padding: 10px;
      border: 2px solid #b5a7bc;
      background-color: #3e2723;
      color: white;
      cursor: grab;
      border-radius: 5px;
      box-shadow: 0 0 5px #ffcc00;
    }
    .task:hover {
      background-color: #795548;
      box-shadow: 0 0 10px #ff6f00;
    }
  </style>
</head>
<body>
  <div class="board">
    <div class="main">
      ğŸ“ã‚¯ã‚¨ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
      <br>
      <input type="text" id="new-task" placeholder="æ–°ã—ã„ã‚¯ã‚¨ã‚¹ãƒˆã‚’è¿½åŠ " />
      <input type="date" id="new-deadline" placeholder="æœŸé–“ã‚’è¨­å®š" />
      <button onclick="addTask()">è¿½åŠ </button>
      <br>
      <br>
      <button onclick="location.reload()">ç”»é¢ã®å†èª­è¾¼</button>
    </div>
  </div>
  <div class="board">
    <div class="column" id="todo">
      ğŸ§­ã‚¯ã‚¨ã‚¹ãƒˆãƒªã‚¹ãƒˆ
    </div>
    <div class="column" id="in-progress">
      âš”ã‚¯ã‚¨ã‚¹ãƒˆä¸­
    </div>
    <div class="column" id="done">
      ğŸ†ã‚¯ã‚¨ã‚¹ãƒˆå®Œäº†
    </div>
  </div>
  <script>
    let isEditing =false;
    
    // ã‚¿ã‚¹ã‚¯ã®ä¿å­˜
    const saveTasks = () => {
      const tasks = {};
      document.querySelectorAll('.column').forEach(column => {
        tasks[column.id] = Array.from(column.querySelectorAll('.task')).map(task => ({
          id: task.id,
          text: task.querySelector('span').textContent.replace('ã€å†…å®¹ã€‘',''),
          deadline: task.querySelector('.deadline')?.textContent.replace('ã€æœŸé™ã€‘','').replace('å‰Šé™¤','').replace('ç·¨é›†','').replace('ä¿å­˜','').trim() || null
        }));
      });
      localStorage.setItem('tasks', JSON.stringify(tasks));
    };
    
    // ã‚¿ã‚¹ã‚¯ã®èª­è¾¼
    const loadTasks = () => {
      const tasks = JSON.parse(localStorage.getItem('tasks')) || {};
      Object.entries(tasks).forEach(([columnId,columnTasks]) => {
        const column = document.getElementById(columnId);
        columnTasks.forEach(taskData => column.appendChild(createTaskElement(taskData)));
      });
      checkDeadlines();
    };
    
    // ã‚¿ã‚¹ã‚¯ã®è¡¨ç¤º
    const createTaskElement = ({ id, text, deadline }) => {
      const task = document.createElement('div');
      task.className = 'task';
      task.id = id;
      task.setAttribute('draggable', true);
      
      const taskContent = document.createElement('span');
      taskContent.textContent = `ã€å†…å®¹ã€‘${text}`;
      task.appendChild(taskContent);
      
      const deadlineContent = document.createElement('div');
      deadlineContent.className = 'deadline';
      deadlineContent.textContent = `ã€æœŸé™ã€‘${deadline}`;
      
      const editBtn = document.createElement('button');
      editBtn.textContent = 'ç·¨é›†';
      editBtn.style.marginLeft = '10px';
      editBtn.onclick = () => {
        editTask(task, { id, text, deadline });
      };
      deadlineContent.appendChild(editBtn);
      
      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'å‰Šé™¤';
      deleteBtn.style.marginLeft = '10px';
      deleteBtn.onclick = () => {
        task.remove();
        saveTasks();
      };
      deadlineContent.appendChild(deleteBtn);
      
      task.appendChild(deadlineContent);
      
      task.ondragstart = e => e.dataTransfer.setData('text/plain', id);
      
      return task;
    };

    // ã‚¿ã‚¹ã‚¯ã®ç·¨é›†
    const editTask = (task, taskData) => {
      isEditing = true;
      
      const taskInput = document.createElement('input');
      taskInput.type = 'text';
      taskInput.value = taskData.text;
      taskInput.style.width = '95%';
      
      const deadlineInput = document.createElement('input');
      deadlineInput.type = 'date';
      deadlineInput.value = taskData.deadline;
      
      const saveBtn = document.createElement('button');
      saveBtn.textContent = 'ä¿å­˜';
      saveBtn.onclick = () => {
        if (!taskInput.value.trim() || !deadlineInput.value.trim()) {
          alert('ã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã¨æœŸé™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
          return;
        }
        taskData.text = taskInput.value;
        taskData.deadline = deadlineInput.value;
        
        const newTaskElement = createTaskElement(taskData);
        task.parentNode.replaceChild(newTaskElement, task);
        isEditing = false;
        saveTasks();
        checkDeadlines();
      };
      
      task.innerHTML = '';
      task.appendChild(taskInput);
      task.appendChild(document.createElement('br'));
      task.appendChild(deadlineInput);
      task.appendChild(saveBtn);
      checkDeadlines();
    };
    
    // ã‚¿ã‚¹ã‚¯ã®è¿½åŠ 
    const addTask = () => {
      const taskInput = document.getElementById('new-task').value.trim();
      const deadlineInput = document.getElementById('new-deadline').value.trim();
      if (!taskInput || !deadlineInput) {
        alert('ã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ã¨æœŸé™ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
        return;
      }
      const newTask = {
        id: `task-${Date.now()}`,
        text: taskInput,
        deadline: deadlineInput
      }
      document.getElementById('todo').appendChild(createTaskElement(newTask));
      document.getElementById('new-task').value = '';
      document.getElementById('new-deadline').value = '';
      saveTasks();
      checkDeadlines();
    }
    
    // æœŸé™ã®ãƒã‚§ãƒƒã‚¯
    const checkDeadlines = () => {
      const today = new Date();
      const todayString = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
      
      document.querySelectorAll('.task').forEach(task => {
        const deadlineElement = task.querySelector('.deadline');
        if (deadlineElement) {
          const deadline = new Date(deadlineElement.textContent.replace('ã€æœŸé™ã€‘','').replace('å‰Šé™¤','').replace('ç·¨é›†','').replace('ä¿å­˜','').trim()).toISOString().split('T')[0];
          if (deadline < todayString) {
            task.style.borderColor = 'red';
            task.style.boxShadow = '0 0 10px red';
          } else if (deadline === todayString) {
            task.style.borderColor = 'orange';
            task.style.boxShadow = '0 0 10px orange';
          } else {
            task.style.borderColor = 'white';
            task.style.boxShadow = '0 0 10px white';
          }
        }
      });
    }
    
    document.querySelectorAll('.column').forEach(column => {
      column.ondragover = e => {
        if (!isEditing) {
          e.preventDefault();
        }
      };
      column.ondrop = e => {
        if (!isEditing) {
          const taskId = e.dataTransfer.getData('text/plain');
          const task = document.getElementById(taskId);
          if (task) {
            column.appendChild(task);
          }
          saveTasks();
        }
      };
    });
    window.onload = loadTasks;
  </script>
</body>
</html>


